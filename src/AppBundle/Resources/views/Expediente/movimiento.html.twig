{% extends "AppBundle::layout.html.twig" %}

{% block content %}

    <style>
        body{
            font-size: 11px;
        }
        input[type=text]{
            margin-bottom: 10px;
            padding:10px;            
        }
        input[type=textarea]{
            margin-bottom: 10px;
            padding:10px;            
        }
        input[type=submit]{
            margin-bottom: 10px;
            padding:10px;            
        }

    </style>


    <div class="col-ls-12">
        <div class="title ">Expediente -> Movimiento</div>
        <hr/>
        {% if expediente != null %}
            <h4 class="text-default">Expediente Número: {{ expediente.nroExpediente }}</h4>        
            <hr/>
        {% endif %}


        {{form_start(form,{'action':'' ,'method':'POST'})}}


        <div class="col-lg-14">

            <div class="col-lg-4">
                <label class="text-default">DESTINO(<span class="text-danger">*</span>)</label>                 
                {{ form_errors(form.ubicacion) }}
                {{ form_widget(form.ubicacion) }}
            </div>  
        </div>

        <div id="contenido" hidden></div>

        <div id="mesaentrada" class="col-xs-14" hidden>
            <div class="dependencia col-lg-4">
                <label class="text-default">DEPENDENCIA(<span class="text-danger">*</span>)</label> 
                <div class="dependencia-val">

                </div>
            </div>                          
        </div>

        <div id="persona" class="col-xs-14" hidden>
            <div class="nombre col-lg-4">
                <label class="text-default">NOMBRE(<span class="text-danger">*</span>)</label>   
                <div class="nombre-val">

                </div>
            </div>                 
        </div>
        <div id="lugarfisico" class="col-xs-14" hidden>
            <div class="lugar col-lg-4">
                <label class="text-default">LUGAR FISICO(<span class="text-danger">*</span>)</label>   
                <div class="lugar-val">

                </div>
            </div>                 
        </div>

        <div class="col-lg-4">
            <label class="text-default">FOJAS</label>
            {{ form_errors(form.fojas) }}
            {{ form_widget(form.fojas) }}
        </div>   
        <div class="col-lg-12">
            <hr/>
            <label class="text-default">OBSERVACIONES</label>
            {{ form_errors(form.observacion) }}
            {{ form_widget(form.observacion) }}
        </div>   
        <div class="col-lg-12">
            <label class="text-default">COMENTARIO</label>
            {{ form_errors(form.comentario) }}
            {{ form_widget(form.comentario) }}
            <hr/>
        </div>  
        <div class="col-lg-3 float left">
            {{ form_widget(form.Aceptar) }}
        </div>
    </div>
    {{form_end(form)}}

</div>      

<script>

    var $ubicacion = $('#movimientoexpediente_ubicacion');
    var $form = $ubicacion.closest('form');

    $ubicacion.on('change', function () {



        var data = $ubicacion.serialize();
        var index = $ubicacion.val();
        $.ajax({
            url: "{{ path('add_movimiento') }}",
            type: "POST",
            data: data,
            success: function (html) {
                // la variable html representa toda la página junto con el select de estados.
                // el cual tomamos y colocamos para reemplazar el select actual.

                if (index == 0) {
                    $('.nombre-val').empty();
                    $('.dependencia-val').empty();
                    $('.lugar-val').empty();
                    $('#persona').hide();
                    $('#mesaentrada').hide();
                    $('#lugarfisico').hide();
                }
                if (index == 1) {
                    $('.nombre-val').empty();
                    $('.dependencia-val').empty();
                    $('.lugarfisico-val').empty();
                    $('#persona').hide();
                    $('#lugarfisico').hide();
                    $('#mesaentrada').show();

                    $('#contenido').html($(html).find('#movimientoexpediente_mesaentrada'));
                    $('#movimientoexpediente_mesaentrada_dependencia').appendTo(".dependencia-val");

                }
                if (index == 2) {
                    $('.nombre-val').empty();
                    $('.dependencia-val').empty();
                    $('.lugar-val').empty();
                    $('#mesaentrada').hide();
                    $('#lugarfisico').hide();
                    $('#persona').show();



                    $('#contenido').html($(html).find('#movimientoexpediente_persona'));
                    $('#movimientoexpediente_persona_nombre').appendTo(".nombre-val");

                    $('#movimientoexpediente_persona_nombre').autocompleter({
                        url_list: "{{ path('persona_search') }}",
                        url_get: "{{ path('persona_get') }}"
                    });
                }
                if (index == 3) {
                    $('.nombre-val').empty();
                    $('.dependencia-val').empty();
                    $('.lugar-val').empty();
                    $('#mesaentrada').hide();
                    $('#persona').hide();
                    $('#lugarfisico').show();

                    $('#contenido').html($(html).find('#movimientoexpediente_lugarfisico'));
                    $('#movimientoexpediente_lugarfisico_tipo').appendTo(".lugar-val");

                }
            }
        });
    });
</script>
{% endblock %}